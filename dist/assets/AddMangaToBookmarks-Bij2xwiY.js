import{j as o,c as f,g as h,p as x,e as c,f as y,r as p,d as b}from"./index-BBOIb04p.js";import{H as B}from"./heading-B3JxPwrU.js";import{p as j}from"./parseISO-D8VFmm5E.js";import{f as D,g as w,h as S,j as v,b as I,k}from"./dropdown-menu-DRJNkDcN.js";import{c as O,B as C}from"./button-CBBu9zPz.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const M=[["path",{d:"m6 9 6 6 6-6",key:"qrunsl"}]],A=O("chevron-down",M),g={ru:"Название на русском",en:"Название на английском",origin:"Оригенальное название"};function P(e){const{title:t}=e,s=t["ru"]||t.ru,r=t.origin||Object.values(t).find(a=>!(a===null||a===s))||null,i=Object.keys(g).map(a=>t[a]?{name:g[a],title:t[a],lang:a}:null).filter(a=>a!==null),l={name:"Другие названия",titles:e.otherTitles};return{main:s,subtitle:r,titles:i,otherTitles:l}}const _=e=>{const{className:t,title:n,items:s,renderItems:r}=e;return o.jsxs("div",{className:f("flex flex-col gap-1 items-start",t),children:[o.jsx(B,{variant:"h5",color:"muted",children:n}),Array.isArray(s)?o.jsx("div",{className:"flex flex-wrap gap-2",children:s.map(r)}):r(s)]})};function E(e){const t=h.MANGA_CATALOG(),n={title:"Тип",value:{content:e.type,link:`${t}?type=${e.type}`}},s={title:"Статус",value:{content:e.status,link:`${t}?status=${e.status}`}},r=e.releaseDate&&{title:"Выпуск",value:{content:String(e.releaseDate.getFullYear()),link:`${t}?releaseDate=${e.releaseDate.toISOString()}`}},i=[n,s].concat(r||[]);return{type:n,status:s,releaseDate:r,basicInfo:i}}function H(e){const{data:t}=x.useSuspenseQuery("get","/manga/byId/{id}",{params:{path:{id:String(e)}}}),n=t.releaseDate&&j(t.releaseDate)||null;return{manga:{...t,releaseDate:n}}}function N(e){const{data:t,isLoading:n}=c.useQuery("get","/manga/byId/{id}/bookmark",{params:{path:{id:String(e)}}});return{data:t,isLoading:n}}function T(e){const t=y(),[n,s]=p.useOptimistic(null),{mutateAsync:r}=c.useMutation("patch","/manga/byId/{id}/bookmark",{onSettled:async()=>{await t.invalidateQueries(c.queryOptions("get","/manga/byId/{id}/bookmark",{params:{path:{id:String(e)}}}))}});return{setBookmark:a=>{p.startTransition(async()=>{s(a),await r({params:{path:{id:String(e)}},body:{bookmark:a}})})},getOptimisticBookmark:(a,u)=>u?null:n||a}}function q(e){const t=y(),{mutate:n,isPending:s}=c.useMutation("delete","/manga/byId/{id}/bookmark",{onSettled:async()=>{await t.invalidateQueries(c.queryOptions("get","/manga/byId/{id}/bookmark",{params:{path:{id:String(e)}}}))}});return{deleteBookmark:()=>n({params:{path:{id:String(e)}}}),isDeletePending:s}}const F=e=>{const{className:t,mangaId:n}=e,{data:s,isLoading:r}=N(n),{setBookmark:i,getOptimisticBookmark:l}=T(n),{deleteBookmark:a,isDeletePending:u}=q(n),{isUserAuth:m}=b();return o.jsxs(D,{children:[o.jsx(w,{asChild:!0,children:o.jsxs(C,{disabled:m&&r,variant:"secondary",className:f("flex justify-between items-center",t),children:[l(s==null?void 0:s.bookmark,u)||"+ Добавить в закладки",o.jsx(A,{})]})}),o.jsxs(S,{className:"w-(--radix-dropdown-menu-trigger-width)",children:[!m&&o.jsx(v,{className:"text-center py-4 px-1",children:"Сначала необходимо войти или зарегестрироваться"}),m&&Object.values(I).map(d=>o.jsx(k,{onClick:()=>i(d),children:d},d)),(s==null?void 0:s.bookmark)&&o.jsx(k,{variant:"destructive",onClick:a,children:"Удалить из закладок"})]})]})};export{F as A,_ as B,P as a,E as b,H as u};
