const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/AboutManga-mJYPfSwo.js","assets/index-BBOIb04p.js","assets/index-DumX69Dr.css","assets/progress-D5Egr4mU.js","assets/button-CBBu9zPz.js","assets/index-Cnn0Zpd9.js","assets/heading-B3JxPwrU.js","assets/skeleton-F-vBBr6W.js","assets/dropdown-menu-DRJNkDcN.js","assets/types-BAOhVOD-.js","assets/index-Dq4Dv7nz.js","assets/index-B52u3quG.js","assets/index-Bg1MQUgi.js","assets/text-disclosure-OeiLiFFg.js","assets/BookMetaLinks-Bxlc_SFV.js","assets/AddMangaToBookmarks-Bij2xwiY.js","assets/parseISO-D8VFmm5E.js","assets/en-US-COFYzLpy.js","assets/tabs-O7DyeGUv.js","assets/arrow-right-zTTAi922.js","assets/badge-3VicvAqn.js","assets/AppAdaptiveImage-DudC7i5n.js","assets/toShortcutNumber-YP-LK2qN.js","assets/eye-D3T0eukC.js","assets/Page-BJCJSSRi.js","assets/Container-RGPOtVEF.js","assets/dialog-B9HZAobp.js","assets/index-DQY5oi3q.js","assets/separator-9rsH-1Uw.js","assets/ToggleOrder-DiWLjHYt.js","assets/useClearInfinityPages-Cbng7GPd.js","assets/useDebounce-eOa9egCm.js","assets/ru-CK6oagpa.js","assets/useTrottle-DRV-miGT.js","assets/input-COoXHJLR.js","assets/CoversModal-Be-bG-jn.js","assets/RateModalContent-CvHRmYnN.js","assets/BookSidebarLayout-CweISIIU.js"])))=>i.map(i=>d[i]);
import{j as e,c as i,L as I,l as u,t as b,h as L,r as d,i as p,_ as h,k as R,e as j,f as P,d as T,m as E}from"./index-BBOIb04p.js";import{P as A}from"./Page-BJCJSSRi.js";import{c as y,B as w,S as O,a as z}from"./button-CBBu9zPz.js";import{H as C}from"./heading-B3JxPwrU.js";import{D as v,a as _,b as N,c as D}from"./dialog-B9HZAobp.js";import{S as V}from"./separator-9rsH-1Uw.js";import{B as q,u as F,a as $,b as G,A as Q}from"./AddMangaToBookmarks-Bij2xwiY.js";import{t as U}from"./toShortcutNumber-YP-LK2qN.js";import{u as H,B as W,C as J,a as K,E as X,T as Y}from"./ToggleOrder-DiWLjHYt.js";import{u as Z,a as ee}from"./useTrottle-DRV-miGT.js";import{I as te}from"./input-COoXHJLR.js";import{E as se}from"./eye-D3T0eukC.js";import{T as ae,e as oe,f as ne,g as re}from"./tabs-O7DyeGUv.js";import{A as M}from"./AppAdaptiveImage-DudC7i5n.js";import{S as ie}from"./skeleton-F-vBBr6W.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const le=[["rect",{width:"18",height:"18",x:"3",y:"3",rx:"2",ry:"2",key:"1m3agn"}],["circle",{cx:"9",cy:"9",r:"2",key:"af1f0g"}],["path",{d:"m21 15-3.086-3.086a2 2 0 0 0-2.828 0L6 21",key:"1xmnt7"}]],ce=y("image",le);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const me=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["path",{d:"M12 16v-4",key:"1dtifu"}],["path",{d:"M12 8h.01",key:"e9boi3"}]],ue=y("info",me);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const de=[["path",{d:"M11.525 2.295a.53.53 0 0 1 .95 0l2.31 4.679a2.123 2.123 0 0 0 1.595 1.16l5.166.756a.53.53 0 0 1 .294.904l-3.736 3.638a2.123 2.123 0 0 0-.611 1.878l.882 5.14a.53.53 0 0 1-.771.56l-4.618-2.428a2.122 2.122 0 0 0-1.973 0L6.396 21.01a.53.53 0 0 1-.77-.56l.881-5.139a2.122 2.122 0 0 0-.611-1.879L2.16 9.795a.53.53 0 0 1 .294-.906l5.165-.755a2.122 2.122 0 0 0 1.597-1.16z",key:"r04s7s"}]],B=y("star",de),xe=s=>{const{className:t,mangaId:a}=s,{chapters:o=[],fetchNextPage:r,isFetching:n,order:c,search:l}=H(a),m=Z(()=>r(),1e3),S=ee(()=>{n||m()});return e.jsx(W,{className:t,order:e.jsx(Y,{...c}),search:e.jsx(te,{className:"max-w-80",placeholder:"Найти главу",...l}),list:e.jsx(J,{chapters:o,renderChapter:f=>e.jsx(K,{before:f.isUserViewed?e.jsx(se,{size:15}):e.jsx(X,{size:15}),mangaId:a,chapter:f},f.id),isLoading:n,skeletonsCount:30,action:e.jsx("div",{ref:S})})})},pe=s=>{const{className:t}=s;return e.jsx(w,{asChild:!0,className:i("flex justify-between items-center gap-1",t),children:e.jsxs(I,{to:"",children:[e.jsx("span",{children:"Начать читать"}),e.jsx("span",{children:"0/565"})]})})},he="_gridTemplete_67mpu_1",ge="_banner_67mpu_12",fe="_cover_67mpu_17",be="_title_67mpu_21",je="_content_67mpu_25",ye="_buttons_67mpu_29",ve="_sidebar_67mpu_33",x={gridTemplete:he,banner:ge,cover:fe,title:be,content:je,buttons:ye,sidebar:ve};function g({asChild:s=!1,...t}){const a=s?O:"div";return e.jsx(a,{"data-slot":"divslot",...t})}const _e=({children:s,asChild:t})=>e.jsx(g,{asChild:t,className:i(x.banner,u.isMobile?"absolute top-0 left-0 right-0 h-162":"-mx-4"),children:s}),Ne=({children:s,asChild:t})=>e.jsx(g,{asChild:t,className:i(x.cover,"z-2",u.isMobile&&"mb-2"),children:s}),Ce=({children:s,asChild:t})=>e.jsx(g,{asChild:t,className:i(x.title,"flex z-2 mb-2",u.isMobile?"flex-col-reverse items-center gap-6":"gap-20 w-full items-end"),children:s}),ke=({children:s,asChild:t})=>e.jsx(g,{asChild:t,className:i(x.buttons,"flex flex-col w-full justify-center items-center max-w-70 grow z-4 gap-1",u.isMobile&&"px-1 mb-2"),children:s}),Te=s=>{const{banner:t,cover:a,title:o,buttons:r,sidebar:n,content:c}=s;return e.jsx(A,{children:e.jsxs("div",{className:i(u.isMobile?"relative flex flex-col gap-1 pt-10 items-center":`${x.gridTemplete} grid gap-4`),children:[t(_e),a(Ne),o(Ce),r(ke),!u.isMobile&&e.jsx("div",{className:i(x.sidebar,"flex flex-col justify-start items-start overflow-auto max-h-125 gap-4 p-3 bg-card shadow-sm rounded-lg"),children:n}),e.jsx("div",{className:i(x.content,"bg-card shadow-sm rounded-lg pb-3 w-full z-5 min-h-100"),children:c})]})})},we=s=>{const{className:t,title:a,subtitle:o}=s;return e.jsxs("div",{className:i("flex flex-col justify-center items-start w-full gap-1",t),children:[e.jsx(C,{className:"line-clamp-2 hyphens-auto break-all",weigth:"semibold",variant:"h2",children:a}),o&&e.jsx(C,{className:"line-clamp-1 hyphens-auto break-all",weigth:"semibold",variant:"h3",italic:!0,children:o})]})},k=s=>{const{title:t,items:a}=s,o=async r=>{try{await navigator.clipboard.writeText(r),b.info("Текст скопирован")}catch{b.error("Текст не скопирован")}};return e.jsx(q,{title:t,items:a,renderItems:r=>e.jsx("span",{onClick:()=>o(r),className:"hover:underline underline-offset-4 hover:opacity-90  cursor-pointer",children:r},r)})},Me=s=>{const{titles:t,otherTitles:a,children:o}=s;return u.isMobile?e.jsxs("div",{className:"flex justify-center items-center gap-2 px-4 max-w-100",children:[e.jsxs(v,{children:[e.jsx(_,{children:e.jsx(ue,{})}),e.jsxs(N,{verticalPosition:"bottom",children:[t.map((r,n)=>e.jsxs(e.Fragment,{children:[e.jsx(k,{title:r.name,items:r.title},n),e.jsx(V,{})]})),!!a.titles.length&&e.jsx(k,{title:a.name,items:a.titles})]})]}),o]}):o},Be=s=>{const{className:t,rate:a,countRate:o,rateButton:r}=s;return e.jsxs("div",{className:i("flex justify-center gap-1 items-end flex-col",u.isMobile&&"bg-card py-1 px-1.5 rounded-sm items-center flex-row",t),children:[e.jsxs("div",{className:"flex gap-1 items-end justify-end",children:[e.jsx(B,{className:"stroke-primary fill-primary mb-0.5",size:20}),e.jsx("span",{className:"text-xl leading-5.5",children:a}),e.jsx("span",{className:"opacity-80",children:U(o)})]}),r]})},Se=s=>{const{className:t}=s;return e.jsx("div",{className:t,children:"comments"})};function Ie(s,t){const[a,o]=L(),[r,n]=d.useState(t),c=d.useCallback(m=>s.includes(m),[s]);d.useLayoutEffect(()=>{const m=a.get("section");c(m)&&n(m)},[]);const l=d.useCallback(m=>{c(m)&&(n(m),a.set("section",m),o(a))},[c,a,o]);return{tabValue:r,onTabChange:l}}const Le=p(()=>h(()=>import("./AboutManga-mJYPfSwo.js"),__vite__mapDeps([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34])),"AboutManga"),Re=["info","chapters","comments"];function Pe(s){const{tabValue:t,onTabChange:a}=Ie(Re,"info");return{tabs:d.useMemo(()=>[{value:"info",title:"О тайтле",content:e.jsx(Le,{mangaId:s})},{value:"chapters",title:"Главы",content:e.jsx(xe,{mangaId:s})},{value:"comments",title:"Комментарии",content:e.jsx(Se,{})}],[s]),tabValue:t,onTabChange:a}}const Ee=s=>{const{className:t,tabs:a,tabValue:o,onTabChange:r}=s;return e.jsxs(ae,{className:t,value:o,onValueChange:r,children:[e.jsx(oe,{className:"w-full justify-start",children:a.map(n=>e.jsx(ne,{value:n.value,children:n.title},n.value))}),a.map(n=>e.jsx(re,{value:n.value,children:n.content},n.value))]})},Ae=s=>{const{className:t,banner:a}=s;return e.jsx(M,{img:a,className:i("min-h-90 before:z-1 before:absolute before:inset-0 before:bg-linear-to-t before:from-white dark:before:from-black",t)})},Oe=p(()=>h(()=>import("./CoversModal-Be-bG-jn.js"),__vite__mapDeps([35,1,2,18,4,19,10,21,6,7])),"CoversModal"),ze=s=>{const{className:t,mangaId:a,cover:o}=s;return e.jsxs(v,{children:[e.jsx(_,{"data-testid":"Cover-Button",className:i("h-full p-0 cursor-pointer shadow-sm ",t),children:e.jsx(M,{img:o,className:"relative w-full pb-[134%]",loadFallback:e.jsx(ie,{className:"w-full h-full"}),children:e.jsx("div",{className:"absolute top-3 right-3 bg-black/70 p-1 rounded-lg z-2 transition-opacity hover:opacity-80",children:e.jsx(ce,{size:20,className:"stroke-primary"})})})}),e.jsx(D,{children:e.jsx(N,{className:"max-w-120 w-[96vw] lg:w-auto",empty:!0,children:e.jsx(d.Suspense,{fallback:e.jsx(R,{variant:"flower",className:"mx-auto"}),children:e.jsx(Oe,{mangaId:a})})})})]})};function De(s){const{data:t,isLoading:a}=j.useQuery("get","/manga/byId/{id}/rate",{params:{path:{id:String(s)}}});return{data:t,isLoading:a}}function Ve(s){const t=P(),[a,o]=d.useOptimistic(null),{mutateAsync:r}=j.useMutation("patch","/manga/byId/{id}/rate",{onSettled:async()=>{await t.invalidateQueries(j.queryOptions("get","/manga/byId/{id}/rate",{params:{path:{id:String(s)}}}))}});return{setRate:l=>{d.startTransition(async()=>{o(l),await r({params:{path:{id:String(s)}},body:{rate:l}})})},getOptimisticRate:l=>a||l}}const qe=p(()=>h(()=>import("./RateModalContent-CvHRmYnN.js"),__vite__mapDeps([36,1,2,26,27,4,11,6,24,25,28,15,16,17,8,9,10,12,22,29,30,31,7,32,33,34,23,18,19,21])),"RateModalContent"),Fe=({children:s})=>{const{isUserAuth:t}=T();return t?e.jsx(_,{asChild:!0,children:s}):e.jsx(z.Provider,{value:{onClick:()=>b.error("Сначала необходимо войти или зарегестрироваться")},children:s})},$e=s=>{const{className:t,mangaId:a}=s,{isUserAuth:o}=T(),{data:r,isLoading:n}=De(a),{getOptimisticRate:c}=Ve(a),l=c(r==null?void 0:r.rate);return e.jsxs(v,{children:[e.jsx(Fe,{children:e.jsxs(w,{disabled:o&&n,className:i(`${l&&"text-md"} h-auto py-1 items-start`,t),children:[!!l&&l,e.jsx(B,{className:i("stroke-primary-foreground",{" fill-primary-foreground":l})}),!l&&"Оценить"]})}),e.jsx(N,{asChild:!0,children:e.jsx(qe,{mangaId:a})})]})},Ge=p(()=>h(()=>import("./BookSidebarLayout-CweISIIU.js"),__vite__mapDeps([37,1,2,4,14,15,6,16,17,8,9,10,11,12,24,25,26,27,28,22,29,30,31,7,32,33,34,23,18,19,21])),"BookSidebarLayout"),Qe=()=>{const{mangaId:s}=E();if(!s)throw new Error("mangaId is required");const{manga:t}=F(s),a=Pe(s),o=$(t),{basicInfo:r}=G(t);return e.jsx(Te,{banner:n=>(t.banner||u.isMobile)&&e.jsx(n,{asChild:!0,children:e.jsx(Ae,{banner:t.banner||t.cover})}),cover:n=>e.jsx(n,{asChild:!0,children:e.jsx(ze,{mangaId:t.id,cover:t.cover,className:i(u.isMobile&&"w-45")})}),title:n=>e.jsxs(n,{children:[e.jsx(Me,{titles:o.titles,otherTitles:o.otherTitles,children:e.jsx(we,{title:o.main,subtitle:o.subtitle})}),e.jsx(Be,{rate:t.rate,countRate:t.countRate,rateButton:e.jsx($e,{mangaId:t.id})})]}),buttons:n=>e.jsxs(n,{children:[e.jsx(pe,{className:"w-full"}),e.jsx(Q,{className:"w-full",mangaId:t.id})]}),sidebar:e.jsx(Ge,{basicInfo:r,otherTitles:o.otherTitles}),content:e.jsx(Ee,{...a})})},Ue=Qe,lt=Object.freeze(Object.defineProperty({__proto__:null,Component:Ue},Symbol.toStringTag,{value:"Module"}));export{k as B,g as D,B as S,Ve as a,lt as m,De as u};
