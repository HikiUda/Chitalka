import{z as y,a as v,e as h,f as b,r as l,j as e,c as m,g as q}from"./index-BBOIb04p.js";import{B as C,X as N}from"./button-CBBu9zPz.js";import{H as L}from"./history-W41l2ejp.js";import"./heading-B3JxPwrU.js";import{B as Q,a as I,b as u,H as w,c as B}from"./badge-3VicvAqn.js";import{S as z}from"./separator-9rsH-1Uw.js";import{I as D}from"./input-COoXHJLR.js";import{u as E}from"./useDebounce-eOa9egCm.js";import{t as d}from"./toShortcutNumber-YP-LK2qN.js";import{S as F}from"./search-v3xDmJYx.js";import{E as H}from"./eye-D3T0eukC.js";import"./AppAdaptiveImage-DudC7i5n.js";import"./skeleton-F-vBBr6W.js";function M(s){const c={queryKey:["get","/manga/quick-search"],queryFn:async()=>await v.GET("/manga/quick-search",{params:{query:{search:s}}}).then(t=>t.data)},{data:n,isFetching:i,refetch:a}=y(c);return{data:n==null?void 0:n.data,isFetching:i,refetch:()=>a()}}function _(){const{data:s,isLoading:c}=h.useQuery("get","/manga/quick-search/last");return{data:s==null?void 0:s.data,isLoading:c}}function A(){const s=b(),[c,n]=l.useState([]),{mutate:i}=h.useMutation("delete","/manga/quick-search/last",{onMutate:({body:a})=>n(t=>t.concat(a.search)),onSuccess:(a,{body:t})=>{s.invalidateQueries(h.queryOptions("get","/manga/quick-search/last")).then(()=>n(r=>r.filter(o=>o!==t.search)))}});return{deleteLastSearch:a=>i({body:{search:a}}),getIsPending:a=>c.includes(a)}}const O=s=>{const{className:c,children:n,onSelectSearch:i,onDelete:a,disabled:t}=s,r=l.useCallback(o=>{o.stopPropagation(),a()},[a]);return e.jsxs("div",{onClick:i,"aria-disabled":t,className:m("grid grid-cols-[auto_1fr_auto] overflow-hidden px-4 py-2.5 items-center gap-2 hover:bg-accent aria-disabled:opacity-70 aria-disabled:pointer-events-none cursor-pointer",c),children:[e.jsx(L,{size:15}),e.jsx("p",{className:"whitespace-nowrap overflow-hidden text-ellipsis",children:n}),e.jsx(C,{variant:"clear",iconSize:"auto",size:"clear",disabled:t,onClick:r,children:e.jsx(N,{size:20})})]})},P=s=>{const{className:c,onSelectSearch:n}=s,{data:i=[]}=_(),{deleteLastSearch:a,getIsPending:t}=A();return i.length?e.jsx("div",{className:c,children:i.map(r=>e.jsx(O,{onSelectSearch:()=>n(r),onDelete:()=>a(r),disabled:t(r),children:r},r))}):null},R=s=>{const{className:c,list:n,renderItem:i,isLoading:a}=s,t=l.useMemo(()=>Array(6).fill(0).map((r,o)=>e.jsx(Q,{},o)),[]);return e.jsx("div",{className:m("grid  grid-cols-1 min-[540px]:grid-cols-2",c),children:a?t.map(r=>r):n.map(i)})},se=()=>{const[s,c]=l.useState(""),{data:n=[],refetch:i,isFetching:a}=M(s),t=E(i,200),r=l.useCallback(o=>{c(o),t()},[t]);return e.jsxs("div",{className:"overflow-auto",children:[e.jsxs("div",{className:"flex justify-center items-center w-full mb-1",children:[e.jsx(F,{size:18}),e.jsx(D,{variant:"clear",value:s,onChangeValue:r,placeholder:"Быстрый поиск"})]}),e.jsx(z,{}),e.jsx(P,{onSelectSearch:r,className:"mb-3"}),e.jsx(R,{list:n,renderItem:({id:o,urlId:p,title:g,type:x,cover:S,views:f,likes:j,bookmarks:k})=>e.jsx(I,{to:q.MANGA(p),title:g,subtitle:x,img:S,children:e.jsxs("div",{className:"flex gap-1 items-center",children:[e.jsxs(u,{variant:"muted",children:[e.jsx(H,{})," ",d(f)]}),e.jsxs(u,{variant:"muted",children:[e.jsx(w,{})," ",d(j)]}),e.jsxs(u,{variant:"muted",children:[e.jsx(B,{})," ",d(k)]})]})},o),isLoading:a})]})};export{se as QuickSearchContent};
