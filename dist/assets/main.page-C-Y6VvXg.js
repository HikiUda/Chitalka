import{p as k,r as p,j as e,c as x,g as y,l as P,u as O,a as $,b as K,d as R,L as B,e as I,f as J}from"./index-BBOIb04p.js";import{C as A,B as W,a as Z}from"./BookCardSkeleton-D3ogWpCX.js";import{C as F,a as T,b,c as H,d as X,T as ee,e as ae,f as se,g as te}from"./tabs-O7DyeGUv.js";import{H as g}from"./heading-B3JxPwrU.js";import{B as U,a as G,b as v,H as re,c as ne}from"./badge-3VicvAqn.js";import{i as E,u as Q}from"./useClearInfinityPages-Cbng7GPd.js";import{c as z,B as D,X as ie}from"./button-CBBu9zPz.js";import{t as f,c as le,n as S,g as oe,e as ce,a as _,m as q,b as M}from"./en-US-COFYzLpy.js";import{r as de}from"./ru-CK6oagpa.js";import{P as ue}from"./Page-BJCJSSRi.js";import{A as w}from"./AppAdaptiveImage-DudC7i5n.js";import{E as me}from"./eye-D3T0eukC.js";import{P as Y}from"./progress-D5Egr4mU.js";import"./skeleton-F-vBBr6W.js";import"./arrow-right-zTTAi922.js";import"./index-Dq4Dv7nz.js";import"./Container-RGPOtVEF.js";import"./index-Cnn0Zpd9.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const he=[["path",{d:"M4 19.5v-15A2.5 2.5 0 0 1 6.5 2H19a1 1 0 0 1 1 1v18a1 1 0 0 1-1 1H6.5a1 1 0 0 1 0-5H20",key:"k3hazp"}]],xe=z("book",he);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const ge=[["path",{d:"M3 6h18",key:"d0wm0j"}],["path",{d:"M19 6v14c0 1-1 2-2 2H7c-1 0-2-1-2-2V6",key:"4alrt4"}],["path",{d:"M8 6V4c0-1 1-2 2-2h4c1 0 2 1 2 2v2",key:"v07s0e"}]],fe=z("trash",ge);function C(a,s){const r=+f(a)-+f(s);return r<0?-1:r>0?1:r}function pe(a){return le(a,Date.now())}function je(a,s,r){const[i,t]=S(r==null?void 0:r.in,a,s),l=i.getFullYear()-t.getFullYear(),o=i.getMonth()-t.getMonth();return l*12+o}function ye(a){return s=>{const i=(a?Math[a]:Math.trunc)(s);return i===0?0:i}}function Ne(a,s){return+f(a)-+f(s)}function be(a,s){const r=f(a,s==null?void 0:s.in);return r.setHours(23,59,59,999),r}function ve(a,s){const r=f(a,s==null?void 0:s.in),i=r.getMonth();return r.setFullYear(r.getFullYear(),i+1,0),r.setHours(23,59,59,999),r}function Me(a,s){const r=f(a,s==null?void 0:s.in);return+be(r,s)==+ve(r,s)}function we(a,s,r){const[i,t,l]=S(r==null?void 0:r.in,a,a,s),o=C(t,l),n=Math.abs(je(t,l));if(n<1)return 0;t.getMonth()===1&&t.getDate()>27&&t.setDate(30),t.setMonth(t.getMonth()-o*n);let c=C(t,l)===-o;Me(i)&&n===1&&C(i,l)===1&&(c=!1);const d=o*(n-+c);return d===0?0:d}function Ce(a,s,r){const i=Ne(a,s)/1e3;return ye(r==null?void 0:r.roundingMethod)(i)}function De(a,s,r){const i=oe(),t=(r==null?void 0:r.locale)??i.locale??ce,l=2520,o=C(a,s);if(isNaN(o))throw new RangeError("Invalid time value");const n=Object.assign({},r,{addSuffix:r==null?void 0:r.addSuffix,comparison:o}),[c,d]=S(r==null?void 0:r.in,...o>0?[s,a]:[a,s]),u=Ce(d,c),N=(_(d)-_(c))/1e3,m=Math.round((u-N)/60);let j;if(m<2)return r!=null&&r.includeSeconds?u<5?t.formatDistance("lessThanXSeconds",5,n):u<10?t.formatDistance("lessThanXSeconds",10,n):u<20?t.formatDistance("lessThanXSeconds",20,n):u<40?t.formatDistance("halfAMinute",0,n):u<60?t.formatDistance("lessThanXMinutes",1,n):t.formatDistance("xMinutes",1,n):m===0?t.formatDistance("lessThanXMinutes",1,n):t.formatDistance("xMinutes",m,n);if(m<45)return t.formatDistance("xMinutes",m,n);if(m<90)return t.formatDistance("aboutXHours",1,n);if(m<q){const h=Math.round(m/60);return t.formatDistance("aboutXHours",h,n)}else{if(m<l)return t.formatDistance("xDays",1,n);if(m<M){const h=Math.round(m/q);return t.formatDistance("xDays",h,n)}else if(m<M*2)return j=Math.round(m/M),t.formatDistance("aboutXMonths",j,n)}if(j=we(d,c),j<12){const h=Math.round(m/M);return t.formatDistance("xMonths",h,n)}else{const h=j%12,L=Math.trunc(j/12);return h<3?t.formatDistance("aboutXYears",L,n):h<9?t.formatDistance("overXYears",L,n):t.formatDistance("almostXYears",L+1,n)}}function ke(a,s){return De(a,pe(a),s)}function Ae(){const{data:a,isLoading:s}=k.useQuery("get","/manga/last-updated",{params:{query:{scope:"popular",limit:15}}});return{data:a==null?void 0:a.data,isLoading:s}}const V=a=>{const{className:s,list:r,renderItem:i,isLoading:t,skeletonsCount:l=3,skeletonClassName:o,heading:n,action:c}=a,d=p.useMemo(()=>Array(l).fill(0).map((u,N)=>e.jsx(U,{className:o},N)),[o,l]);return e.jsxs("div",{className:x("flex flex-col w-full",s),children:[n,r.map(i),t&&d.map(u=>u),c]})},Le=a=>{const{className:s}=a,{data:r=[],isLoading:i}=Ae();return e.jsx(A,{className:s,children:e.jsxs(F,{opts:{dragFree:!0},className:"w-full relative group",children:[e.jsxs(T,{className:"pl-2.5",children:[r.map(({urlId:t,title:l,type:o,chapter:n,cover:c},d)=>e.jsx(b,{className:"basis-auto",children:e.jsx(W,{to:y.MANGA(t),title:l,subtitle:o,img:c,label3:`Глава ${n}`})},d)),i&&Array(10).fill(0).map((t,l)=>e.jsx(b,{className:"basis-auto",children:e.jsx(Z,{})},l))]}),e.jsx(H,{className:"absolute top-1/2 group-hover:-left-4 left-0 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-all duration-300 disabled:opacity-0"}),e.jsx(X,{className:"absolute top-1/2 group-hover:-right-4 right-0 -translate-y-1/2 opacity-0 group-hover:opacity-100 transition-all duration-300 disabled:opacity-0"})]})})};function Pe(){const{data:a,isLoading:s}=k.useQuery("get","/manga",{params:{query:{sortBy:"views",order:"desc",limit:3}}});return{data:a==null?void 0:a.data,isLoading:s}}function Ie(){const{data:a,isLoading:s}=k.useQuery("get","/manga",{params:{query:{sortBy:"createDate",order:"desc",limit:3}}});return{data:a==null?void 0:a.data,isLoading:s}}function Fe(){const{data:a,isLoading:s}=k.useQuery("get","/manga",{params:{query:{sortBy:"rating",order:"desc",limit:3}}});return{data:a==null?void 0:a.data,isLoading:s}}function Te(){const a=Ie(),s=Fe(),r=Pe();return[{heading:"Новинки",...a},{heading:"Рейтинговые",...s},{heading:"Просматриваемые",...r}]}const Ge=a=>{const{className:s}=a,r=Te();return e.jsxs(A,{className:s,children:[e.jsx(g,{variant:"h2",color:"primary",className:"ml-3",children:"Сейчас читают"}),e.jsx(F,{opts:{active:P.isMobile},className:"w-full relative",children:e.jsx(T,{className:"pl-2.5",children:r.map(i=>e.jsx(b,{className:"basis-[90%] sm:basis-[70%] md:basis-[40%] lg:basis-1/3",children:e.jsx(V,{heading:e.jsx(g,{variant:"h3",color:"primary",className:"ml-2 mb-3",children:i.heading}),list:i.data||[],renderItem:t=>e.jsx(G,{to:y.MANGA(t.urlId),img:t.cover,title:t.title,subtitle:t.type},t.id),isLoading:i.isLoading,skeletonsCount:3})},i.heading))})})]})};function Se(){const a=E({queryKey:["get","/manga/last-updated","all",10],queryFn:async({pageParam:n})=>await $.GET("/manga/last-updated",{params:{query:{scope:"all",limit:10,page:n}}}).then(c=>c.data),initialPageParam:1,getNextPageParam:n=>n==null?void 0:n.nextPage}),{data:s,fetchNextPage:r,isFetching:i,isFetchingNextPage:t,hasNextPage:l}=O(a),o=Q(a.queryKey);return p.useEffect(()=>()=>{o()},[]),{data:s==null?void 0:s.pages.flatMap(n=>(n==null?void 0:n.data)||[]),fetchNextPage:r,isFetching:i,isFetchingNextPage:t,hasNextPage:l}}function _e(){const a=E({queryKey:["get","/manga/last-updated","my",10],queryFn:async({pageParam:n})=>await K.GET("/manga/last-updated",{params:{query:{scope:"my",limit:10,page:n}}}).then(c=>c.data),initialPageParam:1,getNextPageParam:n=>n==null?void 0:n.nextPage}),{data:s,fetchNextPage:r,isFetching:i,isFetchingNextPage:t,hasNextPage:l}=O(a),o=Q(a.queryKey);return p.useEffect(()=>()=>{o()},[]),{data:s==null?void 0:s.pages.flatMap(n=>(n==null?void 0:n.data)||[]),fetchNextPage:r,isFetching:i,isFetchingNextPage:t,hasNextPage:l}}function qe(){var r,i;const a=Se(),s=_e();return[{value:"all",title:"Все",catalogLink:`${y.MANGA_CATALOG()}?sortBy=updateDate`,data:a.data||[],fetchNextPage:()=>a.fetchNextPage(),hasNextPage:a.hasNextPage&&(((r=a.data)==null?void 0:r.length)||0)<50,isFetching:a.isFetching||a.isFetchingNextPage},{value:"my",title:"Мои",catalogLink:`${y.MANGA_CATALOG()}?sortBy=updateDate&bookmarks=Reading,Readed`,data:s.data||[],fetchNextPage:()=>s.fetchNextPage(),hasNextPage:s.hasNextPage&&(((i=s.data)==null?void 0:i.length)||0)<50,isFetching:s.isFetching||s.isFetchingNextPage,authOnly:!0}]}const Oe=a=>{const{className:s}=a,r=qe(),{isUserAuth:i}=R();return e.jsxs("div",{className:x(" w-full",s),children:[e.jsx(g,{variant:"h2",color:"primary",className:"mb-2",children:"Последнии обновления"}),e.jsxs(ee,{defaultValue:r[0].value,className:"p-2 bg-card rounded-xl border shadow-sm",children:[e.jsx(ae,{children:r.map(t=>t.authOnly&&!i?null:e.jsx(se,{value:t.value,children:t.title},t.value))}),r.map(t=>t.authOnly&&!i?null:e.jsx(te,{value:t.value,children:e.jsx(V,{list:t.data,renderItem:(l,o)=>e.jsxs(G,{className:`${o<t.data.length-1&&"border-b-1 border-b-primary"}  mb-2`,to:y.MANGA(l.urlId),img:l.cover,title:l.title,children:[e.jsxs("span",{className:"text-sm",children:["Tome ",l.tome," Chapter ",l.chapter]}),e.jsx("span",{className:"text-sm opacity-80",children:ke(new Date(l.chapterCreatedAt),{locale:de,addSuffix:!0})})]},o),isLoading:t.isFetching,skeletonsCount:10,action:t.hasNextPage?e.jsx(D,{onClick:()=>t.fetchNextPage(),className:"w-full",children:"Показать ещё"}):e.jsx(D,{asChild:!0,className:"w-full",children:e.jsx(B,{to:t.catalogLink,children:"В каталог"})})})},t.value))]})]})},Re=a=>{const{className:s}=a;return e.jsxs(B,{to:"/",className:x("grid grid-rows-2 justify-center min-w-[250px] min-h-[210px] px-[10px] pt-[10px] rounded-xl border shadow-sm bg-card",s),children:[e.jsxs("div",{className:"flex flex-col justify-center items-center",children:[e.jsx(g,{weigth:"semibold",className:"line-clamp-2 text-center mb-2",children:"Tittle of collection"}),e.jsxs("div",{className:"flex justify-center items-center flex-wrap gap-1",children:[e.jsxs(v,{children:[e.jsx(me,{})," 1289"]}),e.jsxs(v,{children:[e.jsx(re,{})," 444"]}),e.jsxs(v,{children:[e.jsx(xe,{})," 56"]}),e.jsxs(v,{children:[e.jsx(ne,{})," 33"]})]})]}),e.jsxs("div",{className:"relative overflow-hidden",children:[e.jsx(w,{className:"absolute w-[90px] h-[120px] bottom-[-35px] left-[15px] rotate-[-15deg] z-5 border-4 border-card rounded-lg"}),e.jsx(w,{className:"absolute w-[90px] h-[120px] bottom-[-45px] left-[60px] z-6 border-4 border-card rounded-lg"}),e.jsx(w,{className:"absolute w-[90px] h-[120px] bottom-[-60px] left-[100px] rotate-[15deg] z-7 border-4 border-card rounded-lg"})]})]})},Be=a=>{const{className:s,list:r,renderItem:i,isLoading:t,skeletonsNumber:l=20,heading:o,action:n}=a,c=p.useMemo(()=>Array(l).fill(0).map((d,u)=>e.jsx("div",{},u)),[l]);return e.jsxs("div",{className:x("@container",s),children:[o,e.jsxs("div",{className:"grid gap-4 grid-cols-1 @lg:grid-cols-2 @3xl:grid-cols-3  @5xl:grid-cols-4",children:[r.map(i),t&&c.map(d=>d)]}),n]})},He=p.memo(a=>{const{className:s}=a;return e.jsxs(A,{className:x("min-w-[240px] min-h-[70px] px-2 py-1 flex-row justify-center items-center gap-2",s),children:[e.jsx(w,{className:"w-[50px] h-[50px] shrink-0"}),e.jsxs("div",{className:"grow",children:[e.jsxs("div",{className:"flex justify-between items-center mb-1",children:[e.jsx("span",{children:"Git"}),e.jsx("span",{children:"#1"})]}),e.jsxs("div",{className:"flex justify-between items-center",children:[e.jsx("span",{children:"5 level"}),e.jsx("span",{children:"88/156"})]}),e.jsx(Y,{value:88/156*100})]})]})}),Xe=a=>{const{className:s,list:r,renderItem:i,isLoading:t,skeletonsNumber:l=20,heading:o,action:n}=a,c=p.useMemo(()=>Array(l).fill(0).map((d,u)=>e.jsx("div",{},u)),[l]);return e.jsxs("div",{className:x("@container",s),children:[o,e.jsxs("div",{className:"grid gap-4 grid-cols-1 @lg:grid-cols-2 @3xl:grid-cols-3  @5xl:grid-cols-4",children:[r.map(i),t&&c.map(d=>d)]}),n]})};function Ue(){const{data:a,isLoading:s}=I.useQuery("get","/manga/continue-read");return{data:a==null?void 0:a.data,isLoading:s}}function Ee(){const a=J(),[s,r]=p.useState([]),{mutate:i}=I.useMutation("patch","/manga/continue-read/{id}",{onMutate:({params:t})=>{r(l=>[...l,t.path.id])},onSettled:(t,l,{params:o})=>a.invalidateQueries(I.queryOptions("get","/manga/continue-read")).then(()=>r(n=>n.filter(c=>c!==o.path.id)))});return{deleteContinueReadManga:t=>i({params:{path:{id:t}}}),getIsPending:t=>s.includes(0)||s.includes(t)}}const Qe=a=>{const{className:s,manga:r,disabled:i,onDelete:t}=a,{urlId:l,title:o,chapterCount:n,readedChapters:c,cover:d,tome:u,chapter:N}=r;return e.jsxs(b,{"aria-disabled":i,className:x("relative ml-2 px-1 py-1 bg-card flex rounded-xl border shadow-sm group/manga aria-disabled:opacity-70 aria-disabled:pointer-events-none",s),children:[e.jsx(G,{to:y.MANGA(l),title:o,img:d,children:e.jsxs("div",{children:[e.jsxs("div",{className:"flex justify-between",children:[e.jsxs("span",{children:[u," том ",N," глава"]}),e.jsxs("span",{children:[c," из ",n]})]}),e.jsx(Y,{value:c/n*100})]})}),e.jsx(D,{onClick:t,variant:"destructive",className:P.isMobile?"h-full":"p-5 absolute top-0 right-0 opacity-0 rounded-full z-10 hover:scale-110  group-hover/manga:opacity-100 group-hover/manga:-top-3 group-hover/manga:-right-3 group-hover/manga:rotate-90 transition-all duration-500",children:P.isMobile?e.jsx(fe,{}):e.jsx(ie,{})})]})},ze=a=>{const{className:s}=a,{data:r=[],isLoading:i}=Ue(),{deleteContinueReadManga:t,getIsPending:l}=Ee(),{isUserAuth:o}=R();return!o||!i&&!r.length?null:e.jsxs(A,{className:x(s,"py-0 gap-0"),children:[e.jsxs("div",{className:"flex justify-between align-middle mt-4 mx-3",children:[e.jsx(g,{variant:"h2",color:"primary",children:"Продолжить читать"}),e.jsx(D,{onClick:()=>t(0),disabled:l(0),variant:"clear",children:"очистить"})]}),e.jsxs(F,{opts:{dragFree:!0},className:"w-full relative group/carousel",children:[e.jsxs(T,{className:"pl-4 py-5",children:[r.map((n,c)=>e.jsx(Qe,{manga:n,className:"basis-80",onDelete:()=>t(n.id),disabled:l(n.id)},c)),i&&Array(10).fill(0).map((n,c)=>e.jsx(b,{className:"basis-80 ml-2 px-1 py-1 bg-card  rounded-xl border shadow-sm",children:e.jsx(U,{})},c))]}),e.jsx(H,{className:"absolute top-1/2 -translate-y-1/2 left-0  opacity-0 group-hover/carousel:-left-4 group-hover/carousel:opacity-100 transition-all duration-300 disabled:opacity-0"}),e.jsx(X,{className:"absolute top-1/2 -translate-y-1/2 right-0  opacity-0 group-hover/carousel:-right-4 group-hover/carousel:opacity-100 transition-all duration-300 disabled:opacity-0"})]})]})},Ye=()=>e.jsxs(ue,{children:[e.jsx(Le,{className:"mb-4 w-[99vw] max-w-299"}),e.jsx(ze,{className:"mb-4 w-[99vw] max-w-299"}),e.jsx(Ge,{className:"mb-4 w-[99vw] max-w-299"}),e.jsxs("div",{className:"xl:grid xl:grid-cols-2 xl:items-start gap-5 flex flex-col-reverse items-center",children:[e.jsx(Oe,{}),e.jsxs("div",{className:"flex flex-col gap-4",children:[e.jsx(Be,{heading:e.jsx(g,{variant:"h2",color:"primary",className:"mb-2",children:"Коллекции других пользователей"}),list:Array(6).fill(0),renderItem:(a,s)=>e.jsx(Re,{},s)}),e.jsx(Xe,{heading:e.jsx(g,{variant:"h2",color:"primary",className:"mb-2",children:"Самые активные пользователи"}),list:Array(10).fill(0),renderItem:(a,s)=>e.jsx(He,{},s)})]})]})]}),ma=Ye;export{ma as Component};
