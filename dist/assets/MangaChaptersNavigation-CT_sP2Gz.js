import{r as c,p as k,j as e,c as M,L as g,l as E,g as x}from"./index-BBOIb04p.js";import{H as p}from"./heading-B3JxPwrU.js";import{c as u,B as f}from"./button-CBBu9zPz.js";import{S as I,a as S,b as w,c as z,d as _}from"./sheet-Dhb8weGo.js";import{M as B}from"./move-left-BitLtMKb.js";import{u as T,g as j,B as A,C as H,a as R,E as G,T as O}from"./ToggleOrder-DiWLjHYt.js";import{u as P,a as $}from"./useTrottle-DRV-miGT.js";import{I as q}from"./input-COoXHJLR.js";import{E as D}from"./eye-D3T0eukC.js";/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const F=[["path",{d:"m15 18-6-6 6-6",key:"1wnfg3"}]],U=u("chevron-left",F);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const X=[["path",{d:"m9 18 6-6-6-6",key:"mthhwq"}]],Q=u("chevron-right",X);/**
 * @license lucide-react v0.510.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const V=[["path",{d:"M4 12h16",key:"1lakjw"}],["path",{d:"M4 18h16",key:"19g7jn"}],["path",{d:"M4 6h16",key:"1o0s65"}]],W=u("menu",V);function le(){const[r,s]=c.useState(!1),t=c.useCallback(n=>{const l=n.target,o=Math.floor(window.innerWidth/2),d=50;n.pageX<o-d||n.pageX>o+d||l.closest("main")&&s(h=>!h)},[]),a=c.useCallback(()=>{s(!0)},[]);return c.useEffect(()=>(document.addEventListener("scroll",a),document.addEventListener("click",t),()=>{document.removeEventListener("scroll",a),document.removeEventListener("click",t)}),[a,t]),{hidden:r}}function J(r){const{data:s,isLoading:t}=k.useSuspenseQuery("get","/manga/chapter/{chapterId}",{params:{path:{chapterId:String(r)}}});return{data:s,isLoading:t}}const K=({tome:r,chapter:s,...t})=>E.isMobile?e.jsx(f,{...t,variant:"clear",size:"clear",iconSize:"auto",className:" hover:bg-accent transition-colors h-full",children:e.jsx(W,{size:30})}):e.jsxs(f,{...t,variant:"clear",size:"clear",className:"flex flex-col items-start py-1 px-3 gap-0 hover:bg-accent transition-colors h-full rounded-none",children:[e.jsx(p,{italic:!0,variant:"h5",asChild:!0,children:e.jsx("span",{children:"Оглавление"})}),e.jsx(p,{weigth:"semibold",asChild:!0,children:e.jsx("span",{children:`${r} том ${s} глава`})})]}),Y=r=>{const{className:s,toPrevChapter:t,toNextChapter:a,trigger:n}=r;return e.jsxs("div",{className:M("flex items-center justify-center",s),children:[e.jsx(g,{"aria-disabled":!t,to:t||"",className:"aria-disabled:pointer-events-none aria-disabled:opacity-70 h-full flex items-center hover:bg-accent transition-colors px-2",children:e.jsx(U,{size:30})}),n,e.jsx(g,{"aria-disabled":!a,to:a||"",className:"aria-disabled:pointer-events-none aria-disabled:opacity-70 h-full flex items-center  hover:bg-accent transition-colors px-2",children:e.jsx(Q,{size:30})})]})},Z=r=>{const{trigger:s,children:t,open:a,onOpenChange:n}=r;return e.jsxs(I,{open:a,onOpenChange:n,children:[e.jsx(S,{asChild:!0,children:s}),e.jsxs(w,{children:[e.jsxs(z,{className:"flex items-center gap-1 px-2.5 pt-3 cursor-pointer",children:[e.jsx(B,{className:"stroke-primary"}),e.jsx(p,{color:"primary",asChild:!0,children:e.jsx(_,{children:"Главы"})})]}),t]})]})},de=r=>{const{className:s,mangaId:t,chapterId:a}=r,[n,l]=c.useState(!1),{data:o}=J(a),{chapters:d=[],fetchNextPage:h,isFetching:m,order:C,search:v}=T(t),N=P(()=>h(),1e3),y=$(()=>{m||N()}),b=c.useMemo(()=>{const{prevChapterId:i}=o;return i?x.MANGA_READ(t,j(0,0,i)):null},[o,t]),L=c.useMemo(()=>{const{nextChapterId:i}=o;return i?x.MANGA_READ(t,j(0,0,i)):null},[o,t]);return e.jsx(Y,{className:s,toPrevChapter:b,toNextChapter:L,trigger:e.jsx(Z,{open:n,onOpenChange:l,trigger:e.jsx(K,{tome:o.tome,chapter:o.chapter}),children:e.jsx(A,{order:e.jsx(O,{...C}),search:e.jsx(q,{className:"max-w-80",placeholder:"Найти главу",...v}),list:e.jsx(H,{chapters:d,renderChapter:i=>e.jsx(R,{before:i.isUserViewed?e.jsx(D,{size:15}):e.jsx(G,{size:15}),mangaId:t,chapter:i,onClick:()=>l(!1)},i.id),isLoading:m,skeletonsCount:30,action:e.jsx("div",{className:"h-1",ref:y})})})})})};export{de as M,le as a,J as u};
